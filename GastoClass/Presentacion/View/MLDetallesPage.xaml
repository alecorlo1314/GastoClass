<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="GastoClass.Presentacion.View.MLDetallesPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:chart="clr-namespace:Syncfusion.Maui.Charts;assembly=Syncfusion.Maui.Charts"
    Title="ML Detalles"
    Padding="40"
    BackgroundColor="{StaticResource FondoMenosBlanco}"
    Shell.BackgroundColor="{StaticResource FondoBlanco}"
    Shell.TitleColor="{StaticResource Gray950}">
    <!--  CONTENIDO  -->
    <Grid
        ColumnDefinitions="*,*"
        ColumnSpacing="28"
        RowDefinitions="Auto,*"
        RowSpacing="28">
        <!--  INFORMACION DEL MODELO  -->
        <Border
            Grid.Row="0"
            Grid.Column="0"
            Padding="16"
            BackgroundColor="{StaticResource FondoBlanco}"
            Stroke="Transparent"
            StrokeShape="RoundRectangle 20">
            <VerticalStackLayout Spacing="20">
                <!--  TITULO INFORMACION DEL MODELO  -->
                <VerticalStackLayout Spacing="4">
                    <Label
                        FontFamily="PoppinsSemiBold"
                        FontSize="24"
                        HorizontalTextAlignment="Start"
                        Text="Informacion del Modelo"
                        TextColor="{StaticResource Gray950}"
                        VerticalOptions="Start" />
                    <Label
                        FontFamily="PoppinsRegular"
                        FontSize="14"
                        HorizontalTextAlignment="Start"
                        Text="Detalles sobre el modelo de categorizacion de gasto."
                        TextColor="{StaticResource Gray600}"
                        VerticalOptions="Start" />
                </VerticalStackLayout>
                <!--  NOMBRE MODELO  -->
                <Grid ColumnDefinitions="*,*">
                    <Label
                        Grid.Column="0"
                        FontFamily="PoppinsRegular"
                        FontSize="16"
                        HorizontalOptions="Start"
                        Text="Modelo:"
                        TextColor="{StaticResource Gray900}" />
                    <Label
                        Grid.Column="1"
                        FontFamily="PoppinsRegular"
                        FontSize="16"
                        HorizontalOptions="End"
                        Text="Clasificador de categorias"
                        TextColor="{StaticResource Gray900}" />
                </Grid>
                <!--  ALGORITMO  -->
                <Grid ColumnDefinitions="*,*">
                    <Label
                        Grid.Column="0"
                        FontFamily="PoppinsRegular"
                        FontSize="16"
                        HorizontalOptions="Start"
                        Text="Algoritmo:"
                        TextColor="{StaticResource Gray900}" />
                    <Label
                        Grid.Column="1"
                        FontFamily="PoppinsRegular"
                        FontSize="16"
                        HorizontalOptions="End"
                        Text="LbfgsLogisticRegressionOva"
                        TextColor="{StaticResource Gray900}" />
                </Grid>
                <!--  ULTIMO ENTRENAMIENTO  -->
                <Grid ColumnDefinitions="*,*">
                    <Label
                        Grid.Column="0"
                        FontFamily="PoppinsRegular"
                        FontSize="16"
                        HorizontalOptions="Start"
                        Text="Ultimo entrenamiento:"
                        TextColor="{StaticResource Gray900}" />
                    <Label
                        Grid.Column="1"
                        FontFamily="PoppinsRegular"
                        FontSize="16"
                        HorizontalOptions="End"
                        Text="11/1/2026"
                        TextColor="{StaticResource Gray900}" />
                </Grid>
                <!--  PRECISION ESTIMADA  -->
                <Grid ColumnDefinitions="*,*">
                    <Label
                        Grid.Column="0"
                        FontFamily="PoppinsRegular"
                        FontSize="16"
                        HorizontalOptions="Start"
                        Text="Precision estimada:"
                        TextColor="{StaticResource Gray900}" />
                    <Label
                        Grid.Column="1"
                        FontFamily="PoppinsRegular"
                        FontSize="16"
                        HorizontalOptions="End"
                        Text="96%"
                        TextColor="{StaticResource Gray900}" />
                </Grid>
            </VerticalStackLayout>
        </Border>
        <!--  PRUEBA DEL MODELO  -->
        <Border
            Grid.Row="0"
            Grid.Column="1"
            Padding="16"
            BackgroundColor="{StaticResource FondoBlanco}"
            Stroke="Transparent"
            StrokeShape="RoundRectangle 20">
            <VerticalStackLayout Spacing="20">
                <!--  TITULO PRUEBA DEL MODELO  -->
                <VerticalStackLayout Spacing="4">
                    <Label
                        FontFamily="PoppinsSemiBold"
                        FontSize="24"
                        HorizontalTextAlignment="Start"
                        Text="Prueba del modelo"
                        TextColor="{StaticResource Gray950}"
                        VerticalOptions="Start" />
                    <Label
                        FontFamily="PoppinsRegular"
                        FontSize="14"
                        HorizontalTextAlignment="Start"
                        Text="Introduce una descripcion del gasto para ver una prediccion en tiempo real."
                        TextColor="{StaticResource Gray600}"
                        VerticalOptions="Start" />
                </VerticalStackLayout>
                <!--  NOMBRE MODELO  -->
                <VerticalStackLayout>
                    <Label
                        FontFamily="PoppinsRegular"
                        FontSize="14"
                        HorizontalOptions="Start"
                        Text="Descripcion del gasto"
                        TextColor="{StaticResource Gray900}" />
                    <Border Stroke="Transparent" StrokeShape="RoundRectangle 20">
                        <Entry
                            BackgroundColor="{StaticResource FondoMenosBlanco}"
                            FontFamily="PoppinsRegular"
                            FontSize="16"
                            Placeholder="e.g., Jugo de naranja"
                            PlaceholderColor="{StaticResource Gray500}"
                            Text="{Binding Descripcion}"
                            TextColor="{StaticResource Gray900}" />
                    </Border>
                </VerticalStackLayout>
                <!--  BOTON PREDECIR CATEGORIA  -->
                <Button
                    Margin="0,50,0,0"
                    BackgroundColor="{StaticResource Azul Principal}"
                    BorderColor="Transparent"
                    Command="{Binding RealizarPrediccionCommand}"
                    CornerRadius="15"
                    FontFamily="PoppinsSemiBold"
                    FontSize="16"
                    HeightRequest="42"
                    HorizontalOptions="Start"
                    ImageSource="artificial_intelligence_06.png"
                    IsVisible="{Binding BotonPredecirOculto, Mode=TwoWay}"
                    Text="Predecir Categoria"
                    TextColor="{StaticResource FondoBlanco}"
                    VerticalOptions="End"
                    WidthRequest="225" />
                <Border
                    Margin="0,50,0,0"
                    BackgroundColor="{StaticResource Azul Principal}"
                    HeightRequest="42"
                    HorizontalOptions="Start"
                    IsEnabled="False"
                    IsVisible="{Binding BotonCargandoOculto, Mode=TwoWay}"
                    Stroke="Transparent"
                    StrokeShape="RoundRectangle 15"
                    VerticalOptions="End"
                    WidthRequest="225">
                    <HorizontalStackLayout
                        HorizontalOptions="Center"
                        Spacing="8"
                        VerticalOptions="Center">
                        <ActivityIndicator
                            HeightRequest="24"
                            IsRunning="True"
                            IsVisible="True"
                            WidthRequest="24"
                            Color="{StaticResource FondoBlanco}" />
                        <Label
                            FontFamily="PoppinsSemiBold"
                            FontSize="16"
                            Text="Prediciendo..."
                            TextColor="{StaticResource FondoBlanco}" />
                    </HorizontalStackLayout>
                </Border>
            </VerticalStackLayout>
        </Border>
        <!--  RESULTADOS DE LA PREDICCION  -->
        <Border
            Grid.Row="1"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            Padding="16"
            BackgroundColor="{StaticResource FondoBlanco}"
            IsVisible="{Binding ResultadosVisibles}"
            Stroke="Transparent"
            StrokeShape="RoundRectangle 20">
            <Grid RowDefinitions="Auto,*" RowSpacing="20">
                <!--  TITULO RESULTADO DE LA PREDICCION  -->
                <VerticalStackLayout Grid.Row="0" Spacing="4">
                    <Label
                        FontFamily="PoppinsSemiBold"
                        FontSize="24"
                        HorizontalTextAlignment="Start"
                        Text="Resultado de la prediccion"
                        TextColor="{StaticResource Gray950}"
                        VerticalOptions="Start" />
                    <Label
                        FontFamily="PoppinsRegular"
                        FontSize="14"
                        HorizontalTextAlignment="Start"
                        Text="El modelo predijo las categorias con los siguientes resultados:"
                        TextColor="{StaticResource Gray600}"
                        VerticalOptions="Start" />
                </VerticalStackLayout>
                <!--  CATEGORIA PREDICHA Y LISTA DE LAS CATEGORIAS PREDICHAS  -->
                <Grid Grid.Row="1" RowDefinitions="Auto,Auto">
                    <HorizontalStackLayout Grid.Row="0" Spacing="8">
                        <Label
                            FontFamily="PoppinsSemiBold"
                            FontSize="18"
                            Text="Categoria Predicha: "
                            TextColor="{StaticResource Azul Principal}" />
                        <Label
                            FontFamily="PoppinsSemiBold"
                            FontSize="18"
                            Text="{Binding CategoriaRecomendadaML.Display, Mode=TwoWay}"
                            TextColor="{StaticResource Azul Principal}" />
                    </HorizontalStackLayout>
                    <!--  GRAFICO DE BARRAS  -->
                    <chart:SfCartesianChart
                        Grid.Row="1"
                        HeightRequest="350"
                        IsTransposed="True">
                        <chart:SfCartesianChart.XAxes>
                            <chart:CategoryAxis AutoScrollingDelta="6" />
                        </chart:SfCartesianChart.XAxes>
                        <chart:SfCartesianChart.YAxes>
                            <chart:NumericalAxis />
                        </chart:SfCartesianChart.YAxes>

                        <chart:SfCartesianChart.ZoomPanBehavior>
                            <chart:ChartZoomPanBehavior EnablePanning="True" />
                        </chart:SfCartesianChart.ZoomPanBehavior>

                        <chart:SfCartesianChart.Legend>
                            <chart:ChartLegend IsVisible="True">
                                <chart:ChartLegend.LabelStyle>
                                    <chart:ChartLegendLabelStyle
                                        Margin="5"
                                        FontFamily="PoppinsRegular"
                                        FontSize="14"
                                        TextColor="{StaticResource Gray600}" />
                                </chart:ChartLegend.LabelStyle>
                            </chart:ChartLegend>
                        </chart:SfCartesianChart.Legend>

                        <chart:ColumnSeries
                            EmptyPointMode="Zero"
                            EnableTooltip="True"
                            IsVisibleOnLegend="True"
                            ItemsSource="{Binding CategoriasRecomendadas}"
                            Label="DescripcionCategoriaRecomendada"
                            LabelContext="Percentage"
                            ShowDataLabels="True"
                            XBindingPath="DescripcionCategoriaRecomendada"
                            YBindingPath="ScoreCategoriaRecomendada" />
                    </chart:SfCartesianChart>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</ContentPage>